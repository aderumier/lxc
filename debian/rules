#!/usr/bin/make -f

# output every command that modifies files on the build system.
#DH_VERBOSE = 1

DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

# see EXAMPLES in dpkg-buildflags(1) and read /usr/share/dpkg/*
DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/default.mk

%:
	dh $@  --with autoreconf,autotools-dev,quilt,systemd

override_dh_auto_configure:
	dh_auto_configure -- \
	--with-distro=debian \
	--with-init-script=systemd \
	--enable-apparmor	\
	--enable-doc	\
	--enable-api-docs \
	--disable-rpath \
	--disable-selinux \
	--enable-bash \
	--disable-cgmanager \
	--disable-python \
	--disable-lua \
	--disable-examples \
	--enable-seccomp

override_dh_strip:
	dh_strip --dbg-package=lxc-pve-dbg

override_dh_fixperms:
	dh_fixperms -Xusr/lib/$(DEB_HOST_MULTIARCH)/lxc/lxc-user-nic

override_dh_install:
	rm debian/tmp/usr/lib/x86_64-linux-gnu/*.la
	dh_apparmor -p lxc-pve --profile-name=usr.bin.lxc-start
	dh_apparmor -p lxc-pve --profile-name=lxc-containers
	dh_install --fail-missing

override_dh_systemd_start:
	dh_systemd_start --no-restart-on-upgrade
