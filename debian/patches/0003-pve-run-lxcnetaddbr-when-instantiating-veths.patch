From 84da55875d3a9468957fe0f0012ea2b39b9f7785 Mon Sep 17 00:00:00 2001
From: Wolfgang Bumiller <w.bumiller@proxmox.com>
Date: Fri, 10 Feb 2017 09:15:37 +0100
Subject: [PATCH 03/10] pve: run lxcnetaddbr when instantiating veths

FIXME: Why aren't we using regular up-scripts?

Signed-off-by: Wolfgang Bumiller <w.bumiller@proxmox.com>
---
 src/lxc/network.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/lxc/network.c b/src/lxc/network.c
index a7f054e7..3c0597c7 100644
--- a/src/lxc/network.c
+++ b/src/lxc/network.c
@@ -208,6 +208,11 @@ static int instantiate_veth(struct lxc_handler *handler, struct lxc_netdev *netd
 				 "veth", veth1, (char*) NULL);
 		if (err)
 			goto out_delete;
+	} else if (netdev->link[0] == '\0') {
+		err = run_script(handler->name, "net", "/usr/share/lxc/lxcnetaddbr", "up",
+				 "veth", veth1, (char*) NULL);
+		if (err)
+			goto out_delete;
 	}
 
 	DEBUG("Instantiated veth \"%s/%s\", index is \"%d\"", veth1, veth2,
-- 
2.11.0

