From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Wolfgang Bumiller <w.bumiller@proxmox.com>
Date: Wed, 18 Jul 2018 12:43:37 +0200
Subject: [PATCH] utils: add must_concat helper

Signed-off-by: Wolfgang Bumiller <w.bumiller@proxmox.com>
(cherry picked from commit eb5c2e6aeef233c4f3349d182e5c25315cca8de8)
---
 src/lxc/utils.c | 24 ++++++++++++++++++++++++
 src/lxc/utils.h |  1 +
 2 files changed, 25 insertions(+)

diff --git a/src/lxc/utils.c b/src/lxc/utils.c
index dd6cdc91..9771b900 100644
--- a/src/lxc/utils.c
+++ b/src/lxc/utils.c
@@ -2426,6 +2426,30 @@ int run_command(char *buf, size_t buf_size, int (*child_fn)(void *), void *args)
 	return fret;
 }
 
+char *must_concat(const char *first, ...)
+{
+	va_list args;
+	char *cur, *dest;
+	size_t cur_len, it_len;
+
+	dest = must_copy_string(first);
+	cur_len = it_len = strlen(first);
+
+	va_start(args, first);
+	while ((cur = va_arg(args, char *)) != NULL) {
+		it_len = strlen(cur);
+
+		dest = must_realloc(dest, cur_len + it_len + 1);
+
+		(void)memcpy(dest + cur_len, cur, it_len);
+		cur_len += it_len;
+	}
+	va_end(args);
+
+	dest[cur_len] = 0;
+	return dest;
+}
+
 char *must_make_path(const char *first, ...)
 {
 	va_list args;
diff --git a/src/lxc/utils.h b/src/lxc/utils.h
index 295e7862..ed486853 100644
--- a/src/lxc/utils.h
+++ b/src/lxc/utils.h
@@ -567,6 +567,7 @@ extern int run_command(char *buf, size_t buf_size, int (*child_fn)(void *),
 /* Concatenate all passed-in strings into one path. Do not fail. If any piece
  * is not prefixed with '/', add a '/'.
  */
+__attribute__((sentinel)) extern char *must_concat(const char *first, ...);
 __attribute__((sentinel)) extern char *must_make_path(const char *first, ...);
 __attribute__((sentinel)) extern char *must_append_path(char *first, ...);
 
-- 
2.11.0

